<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="//js.jotform.com/JotFormCustomWidget.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
        crossorigin="anonymous"></script>
    <script type="text/javascript">
        (function () {
            var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
            po.src = '//js.jotform.com/JotFormCustomWidget.min.js?onload=onLoadCallback';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
        })();
    </script>
</head>

<body>
    <style>
        #myTable td {
            padding: 0.25em;
        }

        #val {
            display: block;
            margin-top: 0.5em;
        }
    </style>
    <script type="text/javascript">
        //Global
        function updateSubTotal() {
            var table = document.getElementById("myTable");
            console.log("TABLE ROWS: ", table.rows);
            console.log("TABLE ROWS2: ", Array.from(table.rows).slice(1));
            let subTotal = Array.from(table.rows).slice(1).reduce((total, row) => {
                console.log("TABLE ROWS3: ", row);
                console.log("TABLE ROWS4: ", row.cells);
                console.log("TABLE ROWS5: ", row.cells[1].getElementsByTagName('input')[0].value);

                return total + parseFloat(row.cells[1].getElementsByTagName('input')[0].value);
            }, 0);
            let subTotal2 = Array.from(table.rows).slice(1).reduce((total, row) => {
                return total + parseFloat(row.cells[2].getElementsByTagName('input')[0].value);
            }, 0);
            let subTotal3 = Array.from(table.rows).slice(1).reduce((total, row) => {
                return total + parseFloat(row.cells[3].getElementsByTagName('input')[0].value);
            }, 0);
            // document.getElementById("val").innerHTML = "SubTotal = $" + subTotal.toFixed(2);
            // document.getElementById("val2").innerHTML = "SubTotal2 = $" + subTotal2.toFixed(2);
            // document.getElementById("val3").innerHTML = "SubTotal3 = $" + subTotal3.toFixed(2);
            subTotal = subTotal.toFixed(2);
            subTotal2 = subTotal2.toFixed(2);
            subTotal3 = subTotal3.toFixed(2);

            JFCustomWidget.setFieldsValueById([{
                id: "29",
                value: "$" + subTotal
            }]);
            JFCustomWidget.setFieldsValueById([{
                id: "30",
                value: "$" + subTotal2
            }]);
            JFCustomWidget.setFieldsValueById([{
                id: "31",
                value: "$" + subTotal3
            }]);

        }

        function onClickRemove(deleteButton) {
            let row = deleteButton.parentElement.parentElement;
            row.parentNode.removeChild(row);
            updateSubTotal(); // Call after delete
            resizeFrame();
        }

        function addRow() {
            $("#myTable").append(`<tr><td><input type="text" value=" " /></td><td><input type="number" value="0" min="0"/></td><td><input type="number" value="0" min="0"/></td><td><input type="number" value="0" min="0"/></td><td><button onClick="onClickRemove(this)">Remove</button></td></tr>`);
            updateSubTotal();
            resizeFrame();
        }

        function resizeFrame() {
            const currHeight = $("#myTable").height();
            JFCustomWidget.requestFrameResize({ width: 1000, height: currHeight + 35 })
        }

        $(function () {
            function SOCWidget(containerId, formData) {

                console.log("FORM DATA: ", formData);

                console.log("WIDGETlIB: ", JFCustomWidget)

                /**
               * Exposed
               */
                this.init = init;

                function init() {
                    console.log(formData);

                    console.log("SETTINGS: ", JFCustomWidget.getWidgetSettings());

                    buildHTML();

                }

                function buildHTML() {
                    var newCols = "";
                    var newRows = "";
                    var widgetSettings = JFCustomWidget.getWidgetSettings();

                    widgetSettings["Columns"]
                    widgetSettings["Rows"]

                    const getRowsFromSetting = widgetSettings["Rows"].split(/\r?\n/);
                    const getColsFromSetting = widgetSettings["Columns"].split(/\r?\n/);

                    console.log("STAGE 1 ROWS: ", getRowsFromSetting);
                    console.log("STAGE 1 COLS: ", getColsFromSetting)


                    getColsFromSetting.forEach(function (tHeaders) {
                        newCols += `<th>${tHeaders}</th>`;
                    });

                    getRowsFromSetting.forEach(function (tRows) {
                        newRows += `<tr><td>${tRows}</td><td><input type="number" value="0" min="0" /></td> <td><input type="number" value="0" min="0" /></td><td><input type="number" value="0" min="0" /></td></tr>`;
                    });

                    console.log("STAGE 2 ROWS: ", newRows);
                    console.log("STAGE 2 COLS: ", newCols)

                    document.getElementById("myTable").innerHTML = `<tr>${newCols}</tr>${newRows}`;

                }
            }

            JFCustomWidget.subscribe('submit', function () {

            });

            JFCustomWidget.subscribe('ready', function (data) {
                var widget = new SOCWidget('Test01', data);
                widget.init();
            });
        });

    </script>
    <table id="myTable" onchange="updateSubTotal()" style="overflow: auto; width: 100%; table-layout: fixed;">
        <tr>
            <th>Expense Description</th>
            <th>Projected Expenses</th>
            <th>Mid-year Expenses</th>
            <th>Final Expenses</th>
        </tr>
        <tr>
            <td>Accommodation</td>
            <td><input type="number" value="0" min="0" /></td>
            <td><input type="number" value="0" min="0" /></td>
            <td><input type="number" value="0" min="0" /></td>
        </tr>
        <tr>
            <td>Travel</td>
            <td><input type="number" value="0" min="0" /></td>
            <td><input type="number" value="0" min="0" /></td>
            <td><input type="number" value="0" min="0" /></td>
        </tr>
        <tr>
            <td>Honourariums (facilitators, guest speakers, Clinical Directors, etc.)</td>
            <td><input type="number" value="0" min="0" /></td>
            <td><input type="number" value="0" min="0" /></td>
            <td><input type="number" value="0" min="0" /></td>
        </tr>
        <tr>
            <td>Food & Beverage</td>
            <td><input type="number" value="0" min="0" /></td>
            <td><input type="number" value="0" min="0" /></td>
            <td><input type="number" value="0" min="0" /></td>
        </tr>
        <tr>
            <td>Facility Rentals</td>
            <td><input type="number" value="0" min="0" /></td>
            <td><input type="number" value="0" min="0" /></td>
            <td><input type="number" value="0" min="0" /></td>
        </tr>
        <tr>
            <td>Sport Equipment</td>
            <td><input type="number" value="0" min="0" /></td>
            <td><input type="number" value="0" min="0" /></td>
            <td><input type="number" value="0" min="0" /></td>
        </tr>
        <tr>
            <td>Registration Fees</td>
            <td><input type="number" value="0" min="0" /></td>
            <td><input type="number" value="0" min="0" /></td>
            <td><input type="number" value="0" min="0" /></td>
        </tr>
        <tr>
            <td>Transportation (buses, mileage, taxis, etc.)</td>
            <td><input type="number" value="0" min="0" /></td>
            <td><input type="number" value="0" min="0" /></td>
            <td><input type="number" value="0" min="0" /></td>
        </tr>
        <tr>
            <td>Medical</td>
            <td><input type="number" value="0" min="0" /></td>
            <td><input type="number" value="0" min="0" /></td>
            <td><input type="number" value="0" min="0" /></td>
        </tr>
        <tr>
            <td>Officials</td>
            <td><input type="number" value="0" min="0" /></td>
            <td><input type="number" value="0" min="0" /></td>
            <td><input type="number" value="0" min="0" /></td>
        </tr>
        <tr>
            <td>Meeting/course materials</td>
            <td><input type="number" value="0" min="0" /></td>
            <td><input type="number" value="0" min="0" /></td>
            <td><input type="number" value="0" min="0" /></td>
        </tr>
        <tr>
            <td>Event Rentals (tents, tables, chairs, etc.)</td>
            <td><input type="number" value="0" min="0" /></td>
            <td><input type="number" value="0" min="0" /></td>
            <td><input type="number" value="0" min="0" /></td>
        </tr>
        <tr>
            <td>Printing/copying</td>
            <td><input type="number" value="0" min="0" /></td>
            <td><input type="number" value="0" min="0" /></td>
            <td><input type="number" value="0" min="0" /></td>
        </tr>
        <tr>
            <td>Shipping/postage</td>
            <td><input type="number" value="0" min="0" /></td>
            <td><input type="number" value="0" min="0" /></td>
            <td><input type="number" value="0" min="0" /></td>
        </tr>
        <tr>
            <td>Course fees</td>
            <td><input type="number" value="0" min="0" /></td>
            <td><input type="number" value="0" min="0" /></td>
            <td><input type="number" value="0" min="0" /></td>
        </tr>
        <tr>
            <td>Advertising/PR</td>
            <td><input type="number" value="0" min="0" /></td>
            <td><input type="number" value="0" min="0" /></td>
            <td><input type="number" value="0" min="0" /></td>
        </tr>
    </table>
    <button type="button" onclick="addRow()">Add Row</button>
    <span id="val"></span>
    <span id="val2"></span>
    <span id="val3"></span>

</body>

</html>