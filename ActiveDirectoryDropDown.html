<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <script src="//js.jotform.com/JotFormCustomWidget.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <!-- Optional JavaScript -->
    <script type="text/javascript">
        (function () {
            var po = document.createElement('script');
            po.type = 'text/javascript';
            po.async = true;
            po.src = '//js.jotform.com/JotFormCustomWidget.min.js?onload=onLoadCallback';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(po, s);
        })();
    </script>
</head>

<style>
    * {
        margin: 0px;
        padding: 0px;
        border: 0px;
        box-sizing: border-box;
    }

    body {
        font: 14px Tahoma, Geneva, sans-serif;
        text-align: center;
        padding: 20px;
    }

    h1 {
        padding: 10px;
        color: #333;
        font-size: 20px;
    }

    .dropdown-container {
        margin: 20px 0;
    }

    select {
        padding: 10px;
        margin: 10px;
        border-radius: 5px;
        font-size: 14px;
        width: 250px;
        cursor: pointer;
    }

    .signer-dropdown {
        display: none;
    }
</style>

<body>
    <div class="dropdown-container">
        <label for="locationDropdown"></label>
        <select id="locationDropdown">
            <option value="" disabled selected>Select location</option>
            <option value="New York">New York</option>
            <option value="Los Angeles">Los Angeles</option>
            <option value="Chicago">Chicago</option>
            <option value="Houston">Houston</option>
        </select>
    </div>

    <div class="signer-dropdown" id="signerDropdown">
        <div class="dropdown-container">
            <label for="signer1"></label>
            <select id="signer1"></select>
        </div>
    </div>

    <script>
        "use strict";
        const locations = {
            "New York": ["ny.email1@example.com", "ny.email2@example.com", "ny.email3@example.com"],
            "Los Angeles": ["la.email1@example.com", "la.email2@example.com", "la.email3@example.com"],
            "Chicago": ["ch.email1@example.com", "ch.email2@example.com", "ch.email3@example.com"],
            "Houston": ["hou.email1@example.com", "hou.email2@example.com", "hou.email3@example.com"]
        };

        var params;

        const locationDropdown = document.getElementById("locationDropdown");
        const signerDropdown = document.getElementById("signerDropdown");

        let signer1Value;

        locationDropdown.addEventListener("change", function () {
            const selectedLocation = locationDropdown.value;
            const emails = locations[selectedLocation];
            signerDropdown.style.display = "block";

            updateSignerDropdown("signer1", emails);
            storeSelectedValue("signer1", emails[0]);
            setEmailValueToField();
        });

        function updateSignerDropdown(signerId, emails) {
            const signerSelect = document.getElementById(signerId);
            signerSelect.innerHTML = "";

            emails.forEach((email) => {
                const option = document.createElement("option");
                option.value = email;
                option.textContent = email;
                signerSelect.appendChild(option);
            });

            signerSelect.value = emails[0];

            signerSelect.addEventListener("change", function () {
                storeSelectedValue(signerId, signerSelect.value);
                setEmailValueToField();
            });
        }

        function storeSelectedValue(signerId, value) {
            if (signerId === "signer1") {
                signer1Value = value;
            }
            console.log(`Updated ${signerId} value:`, value);
        }

        function setEmailValueToField() {
            console.log("Email value: ", signer1Value);
            console.log("Field Id: ", params.fieldToFill);

            JFCustomWidget.setFieldsValueById([{
                id: params.fieldToFill,
                value: signer1Value
            }]);
        }

        JFCustomWidget.subscribe('populate', fillConditionValue);

        function fillConditionValue(data) {
            console.log("Fill Data", data);
        }

        JFCustomWidget.subscribe('ready', function (data) {
            params = JFCustomWidget.getWidgetSettings();
        });

        JFCustomWidget.subscribe('submit', function (data) {
            console.log("Form submitted with:", data);
        });

    </script>
</body>

</html>