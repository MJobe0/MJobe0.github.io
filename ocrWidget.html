<!DOCTYPE html>
<html>

<head>
    <script src="//js.jotform.com/JotFormCustomWidget.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src='https://unpkg.com/tesseract.js@v2.1.0/dist/tesseract.min.js'></script>
    <!-- <script type="text/javascript">
        (function () {
            var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
            po.src = '//js.jotform.com/JotFormCustomWidget.min.js?onload=onLoadCallback';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
        })();
    </script> -->
</head>
<style>
</style>

<body>
    <span id="labelText"></span>
    <input type="file" id="input">
    <button id="readButton" onclick="readImage()">Read</button>
    <script type="text/javascript">

        window.Tesseract = Tesseract.create({
            workerPath: window.location.origin + "/tesseract/worker.js", //tesseract.js-1.0.10
            langPath: window.location.origin + "/tesseract/",
            corePath: window.location.origin + "/tesseract/index.js", //tesseract.js-core-0.1.0
        });

        var valid = true;
        var value;
        var jotData;

        const fileInput = document.getElementById('input');
        fileInput.onchange = () => {
            const selectedFile = fileInput.files[0];
            console.log(selectedFile);
        }

        function readImage() {
            const currentSelectedFile = fileInput.files[0];
            console.log(currentSelectedFile)
            if (currentSelectedFile === null && currentSelectedFile === undefined) {
                return console.log("Unable to run no file found")
            }
            if (currentSelectedFile.type !== "image/jpeg" && currentSelectedFile.type !== "image/png") {
                return console.log("Unable to run, not an image file. Only JPEGs and PNGs")
            }
            console.log("Run Tesseract")

            Tesseract.recognize(
                currentSelectedFile,
                'eng',
                { logger: m => console.log(m) }
            ).then(({ data: { text } }) => {
                value = text;
                console.log(text);
            })
        }

        function fillConditionValue(data) {
            // var inputValue = data.value || '';
            //input.val(inputValue.split(","));
            // inputValue = inputValue.split(",")
            JFCustomWidget.hideWidgetError();
            // console.log(inputValue[0])
            // console.log(inputValue[1])
            // jotFormDisplayName = JFCustomWidget.getWidgetSetting("displayName");

            // callNSFASCheck(inputValue[0], jotFormDisplayName);

            var data = {
                value: value,
                valid: valid
            }

            console.log(data.value)
            JFCustomWidget.sendData(data);
        }

        //subscrive to ready
        JFCustomWidget.subscribe("ready", function (msg) {
            console.log("ready message arrived from JotForm", msg);
            //subscribe to submit
            JFCustomWidget.subscribe("submit", function (msg) {
                var data2 = {
                    value: "",
                    valid: true
                }
                console.log(data2)
                JFCustomWidget.sendSubmit(data2);

                // console.log(jotFormStudentName)
                // console.log(jotFormDisplayName)
            });

            JFCustomWidget.subscribe('populate', fillConditionValue);

        });

    </script>
</body>

</html>